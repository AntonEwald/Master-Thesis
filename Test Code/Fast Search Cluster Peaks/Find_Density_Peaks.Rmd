---
title: "Finding Density Peaks"
author: "Anton Holm"
date: '2022-03-19'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



Small dataset
```{r}
#### START ####
source("..//full_method.R")
#Load Data
data2 <- readRDS("(DATA) GMM c = 8")
#Rho, Delta, Slope, Decision Graph
stats2 <- findStats(df = data2$Coordinates, k = 7, estimator = 1, track = FALSE)
#Plot Decision Graph
plot(stats2)
clusters <- clustering(stats2, 0.3)
clusters$assignments[, 1:10]
```

















Some Analysis of the data with 8 clusters
```{r}
#Look at data
ggplot(data = NULL, aes(x = data2$Coordinates[,1], y = data2$Coordinates[,2], col = data2$Samples)) +
  geom_point()

#Create plot to see soft clustering
cluster_probs <- as_tibble(cbind(t(clusters$assignments), data2$Coordinates)) %>% 
  rename("x" = V9, "y" = V10) %>% 
  gather(Class, Value, -c(x, y))
centers2 <- as_tibble(data2$Coordinates[clusters$centerID, ]) %>% 
  rename("x" = V1, "y" = V2)
ggplot(cluster_probs, aes(x = x, y = y, col = Value)) +
  geom_point() +
  geom_point(data = centers2, aes(x = x, y = y), color = "green", size = 1.5) +
  facet_wrap(~Class) +
  scale_color_gradient(low = "blue", high = "red")

#True vs Estimated peak
ggplot(data = NULL) +
  geom_point(aes(x = data2$Coordinates[clusters$centerID,1], y = data2$Coordinates[clusters$centerID, 2]), col = "blue") +
  geom_point(aes(x = data2$Mu[,1], y = data2$Mu[,2]), col = "red")

#Xie-Beni Index
peak_to_peak2 <- dista(data2$Coordinates[clusters$centerID,], data2$Coordinates[clusters$centerID,])
xb_small <- sum((1/ncol(clusters$assignments) * clusters$assignments * dista(data2$Coordinates[clusters$centerID,], data2$Coordinates)))/min(peak_to_peak2[which(peak_to_peak2 > 0)])

xb_small
```



Simulated GMM
-----------------------------------------------------------------
osmFish data

osmFish data
------------------------------------------------------------------
Notes

 
 To Do:
  - Add CTD
  - Add Noise to the GMM as outliers

Difference between max and min should be large
L = 2 or 3 times the avg distance between cells
Take descision graph, fit a linear regression line and subtract it to flip it down on the x-axis. Then check for max and min values (derivative = 0, i.e. peaks and dalar)
Highest rho in grid has delta = L.
Monotonic Regression
Loop
Plateau finder
Look at clustering from fast search paper (look at closest neighbor, then second and so on.)
